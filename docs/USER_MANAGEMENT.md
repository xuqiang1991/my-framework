# ç”¨æˆ·æ³¨å†Œä¸ç®¡ç†æŒ‡å—

## æ¦‚è¿°

æœ¬ç³»ç»Ÿæä¾›äº†å®Œæ•´çš„ç”¨æˆ·æ³¨å†Œä¸ç®¡ç†è§£å†³æ–¹æ¡ˆï¼Œä½œä¸ºå•ç‚¹ç™»å½•ï¼ˆSSOï¼‰çš„ç”¨æˆ·ä¸­å¿ƒï¼Œæ”¯æŒä»¥ä¸‹ä¸‰ç§ç”¨æˆ·æ³¨å†Œæ–¹å¼ï¼š

1. **ç”¨æˆ·è‡ªåŠ©æ³¨å†Œ** - é€šè¿‡å‰ç«¯é¡µé¢è‡ªè¡Œæ³¨å†Œè´¦æˆ·
2. **ç¬¬ä¸‰æ–¹å¹³å°æ³¨å†Œ** - ç¬¬ä¸‰æ–¹ç³»ç»Ÿé€šè¿‡APIç›´æ¥æ³¨å†Œç”¨æˆ·
3. **ç®¡ç†å‘˜åˆ›å»ºç”¨æˆ·** - ç®¡ç†å‘˜é€šè¿‡åå°ç®¡ç†ç³»ç»Ÿåˆ›å»ºç”¨æˆ·

## åŠŸèƒ½ç‰¹æ€§

### âœ¨ æ ¸å¿ƒåŠŸèƒ½

- ğŸ” **ç»Ÿä¸€èº«ä»½ç®¡ç†** - æ‰€æœ‰ç”¨æˆ·ç»Ÿä¸€å­˜å‚¨åœ¨SSOç”¨æˆ·ä¸­å¿ƒ
- ğŸ“ **è‡ªåŠ©æ³¨å†Œ** - ç”¨æˆ·å¯é€šè¿‡æ³¨å†Œé¡µé¢è‡ªè¡Œåˆ›å»ºè´¦æˆ·
- ğŸ”‘ **éªŒè¯ç ä¿æŠ¤** - å›¾å½¢éªŒè¯ç é˜²æ­¢æœºå™¨æ³¨å†Œ
- ğŸ”Œ **ç¬¬ä¸‰æ–¹æ¥å…¥** - æä¾›å®‰å…¨çš„APIä¾›å¤–éƒ¨å¹³å°æ³¨å†Œç”¨æˆ·
- ğŸ‘¥ **ç®¡ç†å‘˜ç»´æŠ¤** - å®Œæ•´çš„ç”¨æˆ·CRUDç®¡ç†åŠŸèƒ½
- ğŸ”— **è·¨å¹³å°ç»‘å®š** - æ”¯æŒç”¨æˆ·åœ¨å¤šä¸ªå¹³å°é—´è´¦å·å…³è”
- ğŸ“Š **æ•°æ®ç»Ÿè®¡** - å®æ—¶ç”¨æˆ·ç»Ÿè®¡å’Œæ´»è·ƒåº¦åˆ†æ

## ä¸€ã€ç”¨æˆ·è‡ªåŠ©æ³¨å†Œ

### 1.1 è®¿é—®æ³¨å†Œé¡µé¢

**é¡µé¢åœ°å€**ï¼š`http://localhost:8082/self-register.html`

### 1.2 æ³¨å†Œæµç¨‹

1. è®¿é—®æ³¨å†Œé¡µé¢
2. å¡«å†™ç”¨æˆ·ä¿¡æ¯ï¼š
   - **ç”¨æˆ·å**ï¼ˆå¿…å¡«ï¼‰ï¼š4-32ä½å­—æ¯ã€æ•°å­—æˆ–ä¸‹åˆ’çº¿
   - **å¯†ç **ï¼ˆå¿…å¡«ï¼‰ï¼šè‡³å°‘8ä½ï¼Œå»ºè®®åŒ…å«å¤§å°å†™ä¸æ•°å­—
   - **ç¡®è®¤å¯†ç **ï¼ˆå¿…å¡«ï¼‰ï¼šå†æ¬¡è¾“å…¥å¯†ç 
   - **æ˜µç§°**ï¼ˆå¯é€‰ï¼‰ï¼šå±•ç¤ºç»™å…¶ä»–ç”¨æˆ·çš„åç§°
   - **é‚®ç®±**ï¼ˆå¯é€‰ï¼‰ï¼šç”¨äºæ‰¾å›å¯†ç ä¸é€šçŸ¥
   - **æ‰‹æœºå·**ï¼ˆå¯é€‰ï¼‰ï¼šç”¨äºå®‰å…¨éªŒè¯
   - **éªŒè¯ç **ï¼ˆå¿…å¡«ï¼‰ï¼šè¾“å…¥å›¾å½¢éªŒè¯ç 
3. ç‚¹å‡»"ç«‹å³æ³¨å†Œ"æŒ‰é’®
4. æ³¨å†ŒæˆåŠŸåï¼Œè‡ªåŠ¨è·³è½¬åˆ°ç™»å½•é¡µé¢

### 1.3 æ³¨å†Œæ¥å£

**æ¥å£åœ°å€**ï¼š`POST /user/register/self`

**è¯·æ±‚ç¤ºä¾‹**ï¼š

```json
{
  "username": "newuser",
  "password": "Password123",
  "nickname": "æ–°ç”¨æˆ·",
  "email": "user@example.com",
  "phone": "13800138000",
  "captcha": "ABCD",
  "captchaKey": "captcha-key-uuid"
}
```

**å“åº”ç¤ºä¾‹**ï¼š

```json
{
  "code": 200,
  "message": "æ“ä½œæˆåŠŸ",
  "data": {
    "userId": "1234567890",
    "username": "newuser",
    "nickname": "æ–°ç”¨æˆ·",
    "email": "user@example.com",
    "phone": "13800138000",
    "status": 1,
    "createTime": "2025-10-30T10:30:00"
  }
}
```

### 1.4 éªŒè¯ç æ¥å£

**è·å–éªŒè¯ç **ï¼š`GET /captcha/generate`

**å“åº”ç¤ºä¾‹**ï¼š

```json
{
  "code": 200,
  "data": {
    "captchaKey": "captcha-123456",
    "captchaImage": "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAA..."
  }
}
```

## äºŒã€ç¬¬ä¸‰æ–¹å¹³å°æ³¨å†Œ

### 2.1 æ¦‚è¿°

ç¬¬ä¸‰æ–¹å¹³å°å¯ä»¥é€šè¿‡å®‰å…¨çš„APIæ¥å£ç›´æ¥ä¸ºç”¨æˆ·åˆ›å»ºè´¦å·ï¼Œæ— éœ€ç”¨æˆ·æ‰‹åŠ¨æ³¨å†Œã€‚é€‚ç”¨äºï¼š
- å·²æœ‰ç”¨æˆ·ç³»ç»Ÿçš„å¹³å°æ¥å…¥SSO
- æ‰¹é‡å¯¼å…¥ç”¨æˆ·
- è‡ªåŠ¨åŒ–ç”¨æˆ·åˆ›å»ºæµç¨‹

### 2.2 è·å–APIå‡­è¯

ç®¡ç†å‘˜éœ€è¦å…ˆä¸ºç¬¬ä¸‰æ–¹å¹³å°ç”ŸæˆAPIå‡­è¯ï¼š

**æ¥å£åœ°å€**ï¼š`POST /api/third-party/admin/generate-key?platformId={platformId}`

**å“åº”ç¤ºä¾‹**ï¼š

```
API Key: ak_test_main_app_001
API Secret: sk_test_main_app_secret_001

è¯·å¦¥å–„ä¿ç®¡API Secretï¼Œå®ƒå°†ä¸ä¼šå†æ¬¡æ˜¾ç¤ºï¼
```

### 2.3 ç­¾åç®—æ³•

ä¸ºç¡®ä¿APIå®‰å…¨ï¼Œæ‰€æœ‰è¯·æ±‚éƒ½éœ€è¦è¿›è¡Œç­¾åéªŒè¯ï¼š

**ç­¾åç”Ÿæˆæ­¥éª¤**ï¼š

1. å°†ä»¥ä¸‹å‚æ•°æŒ‰å­—æ¯é¡ºåºæ’åºï¼š
   - `apiKey`
   - `timestamp`
   - `platformId`
   - `externalUserId`
   - `username`ï¼ˆå¯é€‰ï¼‰

2. å°†å‚æ•°å€¼æ‹¼æ¥æˆå­—ç¬¦ä¸²
3. åœ¨æœ«å°¾è¿½åŠ  `apiSecret`
4. å¯¹æ•´ä¸ªå­—ç¬¦ä¸²è®¡ç®— MD5 å€¼

**Javaç¤ºä¾‹**ï¼š

```java
import cn.hutool.crypto.SecureUtil;
import java.util.TreeMap;

public String calculateSignature(
    String apiKey, 
    String apiSecret, 
    long timestamp, 
    String platformId, 
    String externalUserId, 
    String username
) {
    TreeMap<String, String> params = new TreeMap<>();
    params.put("apiKey", apiKey);
    params.put("timestamp", String.valueOf(timestamp));
    params.put("platformId", platformId);
    params.put("externalUserId", externalUserId);
    if (username != null) {
        params.put("username", username);
    }
    
    StringBuilder signStr = new StringBuilder();
    for (String value : params.values()) {
        signStr.append(value);
    }
    signStr.append(apiSecret);
    
    return SecureUtil.md5(signStr.toString());
}
```

**JavaScriptç¤ºä¾‹**ï¼š

```javascript
const crypto = require('crypto');

function calculateSignature(apiKey, apiSecret, timestamp, platformId, externalUserId, username) {
    const params = {
        apiKey,
        timestamp: timestamp.toString(),
        platformId,
        externalUserId
    };
    
    if (username) {
        params.username = username;
    }
    
    // æŒ‰å­—æ¯é¡ºåºæ’åº
    const sortedKeys = Object.keys(params).sort();
    let signStr = '';
    for (const key of sortedKeys) {
        signStr += params[key];
    }
    signStr += apiSecret;
    
    return crypto.createHash('md5').update(signStr).digest('hex');
}
```

### 2.4 æ³¨å†Œæ¥å£

**æ¥å£åœ°å€**ï¼š`POST /api/third-party/register`

**è¯·æ±‚å¤´**ï¼š
```
Content-Type: application/json
```

**è¯·æ±‚ç¤ºä¾‹**ï¼š

```json
{
  "platformId": "1",
  "externalUserId": "ext_user_12345",
  "externalUsername": "platform_username",
  "username": "newuser",
  "nickname": "å¹³å°ç”¨æˆ·",
  "realName": "å¼ ä¸‰",
  "email": "user@example.com",
  "phone": "13800138000",
  "gender": 1,
  "apiKey": "ak_test_main_app_001",
  "timestamp": 1698654321000,
  "signature": "calculated_md5_signature"
}
```

**å­—æ®µè¯´æ˜**ï¼š

| å­—æ®µ | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|------|------|------|------|
| platformId | String | æ˜¯ | å¹³å°ID |
| externalUserId | String | æ˜¯ | ç¬¬ä¸‰æ–¹å¹³å°çš„ç”¨æˆ·ID |
| externalUsername | String | å¦ | ç¬¬ä¸‰æ–¹å¹³å°çš„ç”¨æˆ·å |
| username | String | å¦ | SSOç”¨æˆ·åï¼ˆè‹¥ä¸ºç©ºä¼šè‡ªåŠ¨ç”Ÿæˆï¼‰ |
| nickname | String | å¦ | æ˜µç§° |
| realName | String | å¦ | çœŸå®å§“å |
| email | String | å¦ | é‚®ç®± |
| phone | String | å¦ | æ‰‹æœºå· |
| gender | Integer | å¦ | æ€§åˆ«ï¼š0-æœªçŸ¥ï¼Œ1-ç”·ï¼Œ2-å¥³ |
| apiKey | String | æ˜¯ | API Key |
| timestamp | Long | æ˜¯ | å½“å‰æ—¶é—´æˆ³ï¼ˆæ¯«ç§’ï¼‰ |
| signature | String | æ˜¯ | ç­¾å |

**å“åº”ç¤ºä¾‹**ï¼š

```json
{
  "code": 200,
  "message": "æ“ä½œæˆåŠŸ",
  "data": {
    "userId": "1234567890",
    "username": "newuser",
    "nickname": "å¹³å°ç”¨æˆ·",
    "email": "user@example.com",
    "status": 1
  }
}
```

### 2.5 æ™ºèƒ½å¤„ç†ç­–ç•¥

ç³»ç»Ÿå¯¹ç¬¬ä¸‰æ–¹æ³¨å†Œæœ‰ä»¥ä¸‹æ™ºèƒ½å¤„ç†ï¼š

1. **é‡å¤æ£€æµ‹**ï¼šå¦‚æœè¯¥å¹³å°ç”¨æˆ·å·²ç»‘å®šè´¦å·ï¼Œç›´æ¥è¿”å›å·²æœ‰ç”¨æˆ·ä¿¡æ¯
2. **ç”¨æˆ·åå†²çª**ï¼šå¦‚æœç”¨æˆ·åå·²è¢«å ç”¨ï¼Œè‡ªåŠ¨ç”Ÿæˆå”¯ä¸€ç”¨æˆ·å
3. **å¯†ç å¤„ç†**ï¼šå¦‚æœä¸æä¾›å¯†ç ï¼Œè‡ªåŠ¨ç”Ÿæˆéšæœºå¯†ç ï¼ˆç¬¬ä¸‰æ–¹ç”¨æˆ·é€šè¿‡SSOç™»å½•ï¼Œæ— éœ€å¯†ç ï¼‰

### 2.6 æŸ¥è¯¢ç”¨æˆ·ç»‘å®šçŠ¶æ€

**æ¥å£åœ°å€**ï¼š`GET /api/third-party/user/status`

**è¯·æ±‚å‚æ•°**ï¼š
- `platformId`ï¼šå¹³å°ID
- `externalUserId`ï¼šå¤–éƒ¨ç”¨æˆ·ID
- `apiKey`ï¼šAPI Key

**å“åº”ç¤ºä¾‹**ï¼š

```json
{
  "code": 200,
  "data": {
    "userId": "1234567890",
    "username": "newuser",
    "nickname": "å¹³å°ç”¨æˆ·",
    "status": 1
  }
}
```

### 2.7 å®‰å…¨å»ºè®®

1. **API Secretä¿æŠ¤**
   - API Secretå¿…é¡»å¦¥å–„ä¿ç®¡ï¼Œä¸è¦æ³„éœ²
   - ä»…åœ¨æœåŠ¡ç«¯ä½¿ç”¨API Secret
   - å®šæœŸè½®æ¢APIå‡­è¯

2. **æ—¶é—´æˆ³éªŒè¯**
   - è¯·æ±‚æ—¶é—´æˆ³ä¸æœåŠ¡å™¨æ—¶é—´è¯¯å·®ä¸èƒ½è¶…è¿‡5åˆ†é’Ÿ
   - é˜²æ­¢é‡æ”¾æ”»å‡»

3. **HTTPSä¼ è¾“**
   - ç”Ÿäº§ç¯å¢ƒå¿…é¡»ä½¿ç”¨HTTPS
   - é˜²æ­¢å‡­è¯åœ¨ä¼ è¾“è¿‡ç¨‹ä¸­è¢«çªƒå–

4. **é€Ÿç‡é™åˆ¶**
   - å»ºè®®å®æ–½APIè°ƒç”¨é¢‘ç‡é™åˆ¶
   - é˜²æ­¢æ¶æ„å¤§é‡æ³¨å†Œ

## ä¸‰ã€ç®¡ç†å‘˜ç”¨æˆ·ç®¡ç†

### 3.1 è®¿é—®ç®¡ç†åå°

**é¡µé¢åœ°å€**ï¼š`http://localhost:8082/admin-user-management.html`

### 3.2 åŠŸèƒ½åˆ—è¡¨

#### 3.2.1 ç”¨æˆ·åˆ—è¡¨

- **æœç´¢åŠŸèƒ½**ï¼šæ”¯æŒæŒ‰ç”¨æˆ·åã€æ˜µç§°ã€é‚®ç®±ã€æ‰‹æœºå·æœç´¢
- **åˆ†é¡µæ˜¾ç¤º**ï¼šæ¯é¡µ10æ¡è®°å½•
- **çŠ¶æ€æ˜¾ç¤º**ï¼šæ˜¾ç¤ºç”¨æˆ·å¯ç”¨/ç¦ç”¨çŠ¶æ€
- **å®æ—¶ç»Ÿè®¡**ï¼šæ˜¾ç¤ºæ€»ç”¨æˆ·æ•°ã€æ´»è·ƒç”¨æˆ·ã€ä»Šæ—¥æ³¨å†Œ

#### 3.2.2 æ–°å¢ç”¨æˆ·

ç‚¹å‡»"æ–°å¢ç”¨æˆ·"æŒ‰é’®ï¼Œå¡«å†™ç”¨æˆ·ä¿¡æ¯ï¼š

- ç”¨æˆ·åï¼ˆå¿…å¡«ï¼‰
- å¯†ç ï¼ˆå¿…å¡«ï¼‰
- æ˜µç§°
- çœŸå®å§“å
- é‚®ç®±
- æ‰‹æœºå·
- æ€§åˆ«
- çŠ¶æ€ï¼ˆå¯ç”¨/ç¦ç”¨ï¼‰

**æ¥å£åœ°å€**ï¼š`POST /user/register/admin`

**è¯·æ±‚ç¤ºä¾‹**ï¼š

```json
{
  "username": "employee001",
  "password": "Welcome123",
  "nickname": "å‘˜å·¥001",
  "realName": "å¼ ä¸‰",
  "email": "employee@company.com",
  "phone": "13800138000",
  "gender": 1
}
```

#### 3.2.3 ç¼–è¾‘ç”¨æˆ·

ç‚¹å‡»ç”¨æˆ·åˆ—è¡¨ä¸­çš„"ç¼–è¾‘"æŒ‰é’®ï¼Œå¯ä¿®æ”¹ç”¨æˆ·ä¿¡æ¯ï¼š

- ç”¨æˆ·åä¸å¯ä¿®æ”¹
- å¯†ç å¯é€‰ï¼ˆç•™ç©ºåˆ™ä¸ä¿®æ”¹ï¼‰
- å…¶ä»–ä¿¡æ¯å‡å¯ä¿®æ”¹

**æ¥å£åœ°å€**ï¼š`PUT /user/update`

**è¯·æ±‚ç¤ºä¾‹**ï¼š

```json
{
  "userId": "1234567890",
  "nickname": "æ–°æ˜µç§°",
  "email": "newemail@example.com",
  "status": 1
}
```

#### 3.2.4 åˆ é™¤ç”¨æˆ·

ç‚¹å‡»"åˆ é™¤"æŒ‰é’®ï¼Œç³»ç»Ÿä¼šè¿›è¡Œé€»è¾‘åˆ é™¤ï¼ˆè½¯åˆ é™¤ï¼‰ã€‚

**æ¥å£åœ°å€**ï¼š`DELETE /user/delete/{userId}`

#### 3.2.5 å¯ç”¨/ç¦ç”¨ç”¨æˆ·

ç‚¹å‡»"å¯ç”¨"æˆ–"ç¦ç”¨"æŒ‰é’®ï¼Œå¿«é€Ÿåˆ‡æ¢ç”¨æˆ·çŠ¶æ€ã€‚

**æ¥å£åœ°å€**ï¼š`PUT /user/update`

**è¯·æ±‚ç¤ºä¾‹**ï¼š

```json
{
  "userId": "1234567890",
  "status": 0
}
```

### 3.3 ç®¡ç†æ¥å£åˆ—è¡¨

| æ¥å£ | æ–¹æ³• | è·¯å¾„ | è¯´æ˜ |
|------|------|------|------|
| æŸ¥è¯¢ç”¨æˆ·åˆ—è¡¨ | GET | `/user/list` | æ”¯æŒåˆ†é¡µå’Œæœç´¢ |
| è·å–ç”¨æˆ·è¯¦æƒ… | GET | `/user/getById/{userId}` | æ ¹æ®IDè·å–ç”¨æˆ· |
| åˆ›å»ºç”¨æˆ· | POST | `/user/register/admin` | ç®¡ç†å‘˜åˆ›å»ºç”¨æˆ· |
| æ›´æ–°ç”¨æˆ· | PUT | `/user/update` | æ›´æ–°ç”¨æˆ·ä¿¡æ¯ |
| åˆ é™¤ç”¨æˆ· | DELETE | `/user/delete/{userId}` | é€»è¾‘åˆ é™¤ç”¨æˆ· |
| æ£€æŸ¥ç”¨æˆ·å | GET | `/user/register/check-username` | æ£€æŸ¥ç”¨æˆ·åæ˜¯å¦å¯ç”¨ |

## å››ã€æ•°æ®åº“è¡¨ç»“æ„

### 4.1 ç”¨æˆ·è¡¨ï¼ˆsys_userï¼‰

```sql
CREATE TABLE `sys_user` (
  `user_id` varchar(64) NOT NULL COMMENT 'ç”¨æˆ·ID',
  `username` varchar(64) NOT NULL COMMENT 'ç”¨æˆ·å',
  `password` varchar(128) NOT NULL COMMENT 'å¯†ç ',
  `nickname` varchar(64) DEFAULT NULL COMMENT 'æ˜µç§°',
  `real_name` varchar(64) DEFAULT NULL COMMENT 'çœŸå®å§“å',
  `phone` varchar(20) DEFAULT NULL COMMENT 'æ‰‹æœºå·',
  `email` varchar(128) DEFAULT NULL COMMENT 'é‚®ç®±',
  `gender` tinyint(1) DEFAULT 0 COMMENT 'æ€§åˆ«ï¼š0-æœªçŸ¥ï¼Œ1-ç”·ï¼Œ2-å¥³',
  `avatar` varchar(512) DEFAULT NULL COMMENT 'å¤´åƒ',
  `status` tinyint(1) DEFAULT 1 COMMENT 'çŠ¶æ€ï¼š0-ç¦ç”¨ï¼Œ1-å¯ç”¨',
  `deleted` tinyint(1) DEFAULT 0 COMMENT 'åˆ é™¤æ ‡å¿—ï¼š0-æœªåˆ é™¤ï¼Œ1-å·²åˆ é™¤',
  `create_time` datetime DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
  `update_time` datetime DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT 'æ›´æ–°æ—¶é—´',
  PRIMARY KEY (`user_id`),
  UNIQUE KEY `uk_username` (`username`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='ç”¨æˆ·è¡¨';
```

### 4.2 ç”¨æˆ·å¹³å°å…³è”è¡¨ï¼ˆsys_user_platformï¼‰

```sql
CREATE TABLE `sys_user_platform` (
  `id` bigint(20) NOT NULL AUTO_INCREMENT COMMENT 'ID',
  `user_id` varchar(64) NOT NULL COMMENT 'ç”¨æˆ·ID',
  `platform_id` varchar(64) NOT NULL COMMENT 'å¹³å°ID',
  `platform_user_id` varchar(128) DEFAULT NULL COMMENT 'å¹³å°ç”¨æˆ·ID',
  `platform_username` varchar(128) DEFAULT NULL COMMENT 'å¹³å°ç”¨æˆ·å',
  `bind_time` datetime DEFAULT CURRENT_TIMESTAMP COMMENT 'ç»‘å®šæ—¶é—´',
  `last_login_time` datetime DEFAULT NULL COMMENT 'æœ€åç™»å½•æ—¶é—´',
  `status` tinyint(1) DEFAULT 1 COMMENT 'çŠ¶æ€ï¼š0-è§£ç»‘ï¼Œ1-å·²ç»‘å®š',
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_user_platform` (`user_id`, `platform_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='ç”¨æˆ·å¹³å°å…³è”è¡¨';
```

### 4.3 APIå‡­è¯è¡¨ï¼ˆsys_api_credentialï¼‰

```sql
CREATE TABLE `sys_api_credential` (
  `credential_id` varchar(64) NOT NULL COMMENT 'å‡­è¯ID',
  `platform_id` varchar(64) NOT NULL COMMENT 'å¹³å°ID',
  `api_key` varchar(128) NOT NULL COMMENT 'API Keyï¼ˆå…¬å¼€ï¼‰',
  `api_secret` varchar(128) NOT NULL COMMENT 'API Secretï¼ˆç§å¯†ï¼‰',
  `status` tinyint(1) DEFAULT 1 COMMENT 'çŠ¶æ€ï¼š0-ç¦ç”¨ï¼Œ1-å¯ç”¨',
  `expires_at` datetime DEFAULT NULL COMMENT 'è¿‡æœŸæ—¶é—´ï¼ˆNULLè¡¨ç¤ºæ°¸ä¸è¿‡æœŸï¼‰',
  `last_used_at` datetime DEFAULT NULL COMMENT 'æœ€åä½¿ç”¨æ—¶é—´',
  `created_at` datetime DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
  `updated_at` datetime DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT 'æ›´æ–°æ—¶é—´',
  PRIMARY KEY (`credential_id`),
  UNIQUE KEY `uk_api_key` (`api_key`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='APIå‡­è¯è¡¨';
```

## äº”ã€é›†æˆOAuth2 SSO

æ‰€æœ‰æ³¨å†Œçš„ç”¨æˆ·éƒ½å¯ä»¥é€šè¿‡OAuth2å•ç‚¹ç™»å½•è®¿é—®æ¥å…¥çš„å¹³å°ã€‚

### 5.1 ç™»å½•æµç¨‹

1. ç”¨æˆ·è®¿é—®ç¬¬ä¸‰æ–¹åº”ç”¨
2. åº”ç”¨å¼•å¯¼ç”¨æˆ·åˆ°SSOæˆæƒç«¯ç‚¹
3. ç”¨æˆ·ç™»å½•ï¼ˆä½¿ç”¨æ³¨å†Œçš„ç”¨æˆ·åå’Œå¯†ç ï¼‰
4. ç”¨æˆ·ç¡®è®¤æˆæƒ
5. SSOç”Ÿæˆæˆæƒç å¹¶é‡å®šå‘
6. åº”ç”¨ä½¿ç”¨æˆæƒç æ¢å–è®¿é—®ä»¤ç‰Œ
7. åº”ç”¨ä½¿ç”¨ä»¤ç‰Œè·å–ç”¨æˆ·ä¿¡æ¯
8. ç™»å½•æˆåŠŸ

è¯¦ç»†è¯´æ˜è¯·å‚è€ƒï¼š[SSO.md](SSO.md)

### 5.2 OAuth2æ¥å£

- **æˆæƒç«¯ç‚¹**ï¼š`GET /oauth2/authorize`
- **ä»¤ç‰Œç«¯ç‚¹**ï¼š`POST /oauth2/token`
- **ç”¨æˆ·ä¿¡æ¯ç«¯ç‚¹**ï¼š`GET /oauth2/userinfo`

## å…­ã€å¸¸è§é—®é¢˜

### Q1: ç”¨æˆ·åå·²å­˜åœ¨æ€ä¹ˆåŠï¼Ÿ

**è‡ªåŠ©æ³¨å†Œ**ï¼šæç¤ºç”¨æˆ·é€‰æ‹©å…¶ä»–ç”¨æˆ·åã€‚

**ç¬¬ä¸‰æ–¹æ³¨å†Œ**ï¼šç³»ç»Ÿä¼šè‡ªåŠ¨ç”Ÿæˆå”¯ä¸€ç”¨æˆ·åï¼Œæ ¼å¼ä¸ºï¼š`{åŸç”¨æˆ·å}_{å¹³å°IDå4ä½}_{6ä½éšæœºæ•°å­—}`

### Q2: å¦‚ä½•é‡ç½®ç”¨æˆ·å¯†ç ï¼Ÿ

ç®¡ç†å‘˜å¯ä»¥é€šè¿‡ç®¡ç†åå°ç¼–è¾‘ç”¨æˆ·ï¼Œè®¾ç½®æ–°å¯†ç ã€‚

### Q3: ç¬¬ä¸‰æ–¹å¹³å°ç”¨æˆ·å¦‚ä½•ç™»å½•ï¼Ÿ

ç¬¬ä¸‰æ–¹å¹³å°ç”¨æˆ·é€šè¿‡OAuth2å•ç‚¹ç™»å½•æµç¨‹è®¿é—®ã€‚å¦‚æœå¹³å°ç”¨æˆ·å·²ç»‘å®šSSOè´¦å·ï¼Œç›´æ¥ä½¿ç”¨ç»‘å®šçš„è´¦å·ç™»å½•ã€‚

### Q4: APIç­¾åéªŒè¯å¤±è´¥æ€ä¹ˆåŠï¼Ÿ

1. æ£€æŸ¥API Keyå’ŒSecretæ˜¯å¦æ­£ç¡®
2. æ£€æŸ¥æ—¶é—´æˆ³æ˜¯å¦åœ¨æœ‰æ•ˆèŒƒå›´å†…ï¼ˆÂ±5åˆ†é’Ÿï¼‰
3. æ£€æŸ¥ç­¾åç®—æ³•æ˜¯å¦æ­£ç¡®
4. ç¡®è®¤å‚æ•°æ‹¼æ¥é¡ºåºï¼ˆæŒ‰å­—æ¯é¡ºåºï¼‰

### Q5: å¦‚ä½•æ‰¹é‡å¯¼å…¥ç”¨æˆ·ï¼Ÿ

å¯ä»¥ç¼–å†™è„šæœ¬è°ƒç”¨ç¬¬ä¸‰æ–¹æ³¨å†ŒAPIæ‰¹é‡å¯¼å…¥ï¼Œæˆ–è€…ç›´æ¥åœ¨æ•°æ®åº“ä¸­æ’å…¥ç”¨æˆ·è®°å½•ã€‚

## ä¸ƒã€æœ€ä½³å®è·µ

### 7.1 ç”¨æˆ·æ³¨å†Œ

1. **éªŒè¯ç ä¿æŠ¤**ï¼šå§‹ç»ˆå¯ç”¨éªŒè¯ç é˜²æ­¢æœºå™¨æ³¨å†Œ
2. **é‚®ç®±éªŒè¯**ï¼šå»ºè®®å¢åŠ é‚®ç®±éªŒè¯æµç¨‹
3. **å¯†ç å¼ºåº¦**ï¼šè¦æ±‚è‡³å°‘8ä½ï¼ŒåŒ…å«å¤§å°å†™å­—æ¯å’Œæ•°å­—
4. **ç”¨æˆ·åè®®**ï¼šæ·»åŠ ç”¨æˆ·åè®®å’Œéšç§æ”¿ç­–

### 7.2 ç¬¬ä¸‰æ–¹æ¥å…¥

1. **å‡­è¯ç®¡ç†**ï¼šå®šæœŸè½®æ¢APIå‡­è¯
2. **é”™è¯¯å¤„ç†**ï¼šå®ç°å®Œå–„çš„é”™è¯¯å¤„ç†å’Œé‡è¯•æœºåˆ¶
3. **æ—¥å¿—è®°å½•**ï¼šè®°å½•æ‰€æœ‰APIè°ƒç”¨æ—¥å¿—
4. **ç›‘æ§å‘Šè­¦**ï¼šç›‘æ§APIè°ƒç”¨é¢‘ç‡å’Œå¤±è´¥ç‡

### 7.3 ç”¨æˆ·ç®¡ç†

1. **æƒé™æ§åˆ¶**ï¼šä»…æˆæƒç®¡ç†å‘˜è®¿é—®ç®¡ç†åå°
2. **æ“ä½œå®¡è®¡**ï¼šè®°å½•æ‰€æœ‰ç”¨æˆ·ç®¡ç†æ“ä½œ
3. **å®šæœŸæ¸…ç†**ï¼šå®šæœŸæ¸…ç†é•¿æœŸæœªä½¿ç”¨çš„è´¦å·
4. **æ•°æ®å¤‡ä»½**ï¼šå®šæœŸå¤‡ä»½ç”¨æˆ·æ•°æ®

## å…«ã€ç›¸å…³æ–‡æ¡£

- [SSO å•ç‚¹ç™»å½•æŒ‡å—](SSO.md)
- [API æ¥å£æ–‡æ¡£](API.md)
- [éƒ¨ç½²æ–‡æ¡£](DEPLOY.md)
- [ç³»ç»Ÿæ¶æ„è¯´æ˜](README.md)

## ä¹ã€æŠ€æœ¯æ”¯æŒ

å¦‚æœ‰é—®é¢˜æˆ–å»ºè®®ï¼Œè¯·æäº¤Issueæˆ–è”ç³»æŠ€æœ¯æ”¯æŒå›¢é˜Ÿã€‚

---

**æœ€åæ›´æ–°**ï¼š2025-10-30

