# My Framework - Spring Cloud Alibaba å¾®æœåŠ¡æ¡†æ¶

## ğŸ“ é¡¹ç›®ç®€ä»‹

è¿™æ˜¯ä¸€ä¸ªåŸºäº **Spring Cloud Alibaba** æ„å»ºçš„ç°ä»£åŒ–å¾®æœåŠ¡æ¡†æ¶ï¼Œé›†æˆäº†ä¸»æµçš„å¾®æœåŠ¡æŠ€æœ¯æ ˆï¼Œæä¾›äº†å®Œæ•´çš„å¾®æœåŠ¡è§£å†³æ–¹æ¡ˆã€‚

### âœ¨ æ ¸å¿ƒç‰¹æ€§

- ğŸ” **ç»Ÿä¸€é‰´æƒ**: Sa-Token + JWT + OAuth2 å•ç‚¹ç™»å½•ï¼ˆSSOï¼‰
- ğŸ‘¥ **å¤šå¹³å°æ”¯æŒ**: æ”¯æŒå¤šåº”ç”¨æ¥å…¥ã€ç”¨æˆ·è´¦å·å…³è”ã€è·¨å¹³å°å•ç‚¹ç™»å½•
- ğŸšª **ç½‘å…³è·¯ç”±**: Spring Cloud Gateway + åŠ¨æ€è·¯ç”±
- ğŸ“¡ **æœåŠ¡æ²»ç†**: NacosæœåŠ¡æ³¨å†Œä¸å‘ç°ã€é…ç½®ä¸­å¿ƒ
- ğŸ’¾ **æ•°æ®å­˜å‚¨**: MySQL 8.0 + MyBatis Plus + Druid
- ğŸ”¥ **ç¼“å­˜æ–¹æ¡ˆ**: Redis + åˆ†å¸ƒå¼ç¼“å­˜
- ğŸ“Š **ç›‘æ§ä½“ç³»**: Sentinel + Prometheus + Grafana + **SkyWalking**
- ğŸ” **åˆ†å¸ƒå¼è¿½è¸ª**: SkyWalking APM å…¨é“¾è·¯ç›‘æ§
- ğŸ³ **å®¹å™¨åŒ–**: Docker + Docker Compose ä¸€é”®éƒ¨ç½²
- â˜• **æœ€æ–°æŠ€æœ¯**: JDK 21 + Spring Boot 3.2

## ğŸ—ï¸ æ¶æ„è®¾è®¡

```
my-framework
â”œâ”€â”€ framework-common       # å…¬å…±æ¨¡å—ï¼ˆå·¥å…·ç±»ã€å¸¸é‡ã€å¼‚å¸¸å¤„ç†ï¼‰
â”œâ”€â”€ framework-api          # APIæ¨¡å—ï¼ˆFeignæ¥å£å®šä¹‰ï¼‰
â”œâ”€â”€ framework-gateway      # ç½‘å…³æœåŠ¡ï¼ˆè·¯ç”±ã€é‰´æƒã€é™æµï¼‰
â”œâ”€â”€ framework-auth         # è®¤è¯æœåŠ¡ï¼ˆç™»å½•ã€Tokenç®¡ç†ï¼‰
â””â”€â”€ framework-user         # ç”¨æˆ·æœåŠ¡ï¼ˆç”¨æˆ·ç®¡ç†ç¤ºä¾‹ï¼‰
```

### æ¶æ„å›¾

```
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   å‰ç«¯åº”ç”¨       â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  Gatewayç½‘å…³    â”‚
                    â”‚  - è·¯ç”±è½¬å‘     â”‚
                    â”‚  - ç»Ÿä¸€é‰´æƒ     â”‚
                    â”‚  - é™æµç†”æ–­     â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚                  â”‚                  â”‚
  â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”
  â”‚  Auth Service â”‚  â”‚ User Service â”‚  â”‚ Other Service â”‚
  â”‚  è®¤è¯æœåŠ¡     â”‚  â”‚  ç”¨æˆ·æœåŠ¡    â”‚  â”‚  å…¶ä»–æœåŠ¡     â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚                  â”‚                  â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”´â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
      â”‚                    â”‚    â”‚                â”‚
â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â–¼â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”
â”‚   Nacos   â”‚       â”‚    MySQL    â”‚      â”‚   Redis   â”‚
â”‚æœåŠ¡æ³¨å†Œ/é…ç½®â”‚      â”‚   æ•°æ®åº“     â”‚      â”‚   ç¼“å­˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ› ï¸ æŠ€æœ¯æ ˆ

| æŠ€æœ¯ | ç‰ˆæœ¬ | è¯´æ˜ |
|------|------|------|
| JDK | 21 | Javaå¼€å‘å·¥å…·åŒ… |
| Spring Boot | 3.2.0 | åŸºç¡€æ¡†æ¶ |
| Spring Cloud | 2023.0.0 | å¾®æœåŠ¡æ¡†æ¶ |
| Spring Cloud Alibaba | 2023.0.1.0 | é˜¿é‡Œå¾®æœåŠ¡å¥—ä»¶ |
| Nacos | 2.3.0 | æœåŠ¡æ³¨å†Œä¸é…ç½®ä¸­å¿ƒ |
| Sentinel | 1.8.6 | æµé‡æ§åˆ¶ã€ç†”æ–­é™çº§ |
| Gateway | 4.1.0 | å¾®æœåŠ¡ç½‘å…³ |
| Sa-Token | 1.37.0 | æƒé™è®¤è¯æ¡†æ¶ |
| JWT | 0.12.3 | Tokenç”Ÿæˆä¸éªŒè¯ |
| MySQL | 8.0 | å…³ç³»å‹æ•°æ®åº“ |
| MyBatis Plus | 3.5.5 | ORMæ¡†æ¶ |
| Redis | 7.x | ç¼“å­˜æ•°æ®åº“ |
| Druid | 1.2.20 | æ•°æ®åº“è¿æ¥æ±  |
| Hutool | 5.8.23 | Javaå·¥å…·ç±»åº“ |
| Knife4j | 4.4.0 | APIæ–‡æ¡£å·¥å…· |
| Prometheus | latest | ç›‘æ§ç³»ç»Ÿ |
| Grafana | latest | æ•°æ®å¯è§†åŒ– |
| **SkyWalking** | **9.7.0** | **åˆ†å¸ƒå¼è¿½è¸ªAPM** |
| Elasticsearch | 8.11.0 | SkyWalking å­˜å‚¨ |
| Docker | latest | å®¹å™¨åŒ–å¹³å° |

## ğŸš€ å¿«é€Ÿå¼€å§‹

### å‰ç½®è¦æ±‚

- JDK 21+
- Maven 3.8+
- Docker & Docker Compose
- Git

### æ–¹å¼ä¸€ï¼šDocker Compose éƒ¨ç½²ï¼ˆæ¨èï¼‰

1. **å…‹éš†é¡¹ç›®**
```bash
git clone <your-repo-url>
cd my-framework
```

2. **ä¸‹è½½ SkyWalking Agentï¼ˆé¦–æ¬¡å¯åŠ¨å¿…éœ€ï¼‰**
```bash
# Linux/Mac
cd docker/skywalking
chmod +x download-agent.sh
./download-agent.sh
cd ../..

# Windows
cd docker\skywalking
download-agent.bat
cd ..\..
```

3. **æ„å»ºé¡¹ç›®**
```bash
# Linux/Mac
chmod +x scripts/dev/build.sh
./scripts/dev/build.sh

# Windows
scripts\dev\build.bat
```

4. **å¯åŠ¨æ‰€æœ‰æœåŠ¡**
```bash
# Linux/Mac
chmod +x scripts/dev/start.sh
./scripts/dev/start.sh

# Windows
scripts\dev\start.bat
```

5. **ç­‰å¾…æœåŠ¡å¯åŠ¨å®Œæˆï¼ˆçº¦3-5åˆ†é’Ÿï¼‰**

### æ–¹å¼äºŒï¼šæœ¬åœ°å¼€å‘æ¨¡å¼

1. **å¯åŠ¨åŸºç¡€è®¾æ–½**
```bash
docker-compose up -d mysql redis nacos sentinel
```

2. **ç­‰å¾…Nacoså¯åŠ¨å®Œæˆï¼ˆçº¦1åˆ†é’Ÿï¼‰**

3. **å¯åŠ¨å„ä¸ªå¾®æœåŠ¡**
```bash
# å¯åŠ¨ç½‘å…³æœåŠ¡
cd framework-gateway
mvn spring-boot:run

# å¯åŠ¨è®¤è¯æœåŠ¡
cd framework-auth
mvn spring-boot:run

# å¯åŠ¨ç”¨æˆ·æœåŠ¡
cd framework-user
mvn spring-boot:run
```

### åœæ­¢æœåŠ¡

```bash
# Linux/Mac
chmod +x scripts/dev/stop.sh
./scripts/dev/stop.sh

# Windows
scripts\dev\stop.bat
```

## ğŸ“¡ æœåŠ¡åœ°å€

| æœåŠ¡ | åœ°å€ | è´¦å·/å¯†ç  | è¯´æ˜ |
|------|------|-----------|------|
| ç½‘å…³æœåŠ¡ | http://localhost:8080 | - | ç»Ÿä¸€å…¥å£ |
| è®¤è¯æœåŠ¡ | http://localhost:8081 | - | è®¤è¯æœåŠ¡ç›´è¿ |
| ç”¨æˆ·æœåŠ¡ | http://localhost:8082 | - | ç”¨æˆ·æœåŠ¡ç›´è¿ |
| Nacosæ§åˆ¶å° | http://localhost:8848/nacos | nacos/nacos | æœåŠ¡æ³¨å†Œ/é…ç½® |
| Sentinelæ§åˆ¶å° | http://localhost:8858 | sentinel/sentinel | æµæ§ç®¡ç† |
| Prometheus | http://localhost:9090 | - | ç›‘æ§æ•°æ® |
| Grafana | http://localhost:3000 | admin/admin | æ•°æ®å¯è§†åŒ– |
| SkyWalking UI** | **http://localhost:8088 | åˆ†å¸ƒå¼è¿½è¸ªUI |
| Elasticsearch | http://localhost:9200 | - | SkyWalking å­˜å‚¨ |
| MySQL | localhost:3306 | root/root | æ•°æ®åº“ |
| Redis | localhost:6379 | - | ç¼“å­˜ |
| Druidç›‘æ§ | http://localhost:8082/druid | admin/admin | æ•°æ®åº“è¿æ¥æ± ç›‘æ§ |

## ğŸ”‘ ç™»å½•æ–¹å¼

**âš ï¸ é‡è¦æç¤º**ï¼šæœ¬ç³»ç»Ÿå·²å®Œå…¨é‡‡ç”¨ **OAuth2 å•ç‚¹ç™»å½•ï¼ˆSSOï¼‰** æ¨¡å¼ï¼Œä¸å†æ”¯æŒä¼ ç»Ÿçš„ç”¨æˆ·åå¯†ç ç›´æ¥ç™»å½•ã€‚

æ‰€æœ‰åº”ç”¨å¿…é¡»é€šè¿‡ OAuth2 æˆæƒæµç¨‹æ¥å…¥è®¤è¯ä¸­å¿ƒã€‚è¯¦ç»†è¯´æ˜è¯·æŸ¥çœ‹ï¼š[SSO.md](SSO.md)

### å¿«é€Ÿç™»å½•æµç¨‹

1. **å¼•å¯¼ç”¨æˆ·åˆ°æˆæƒç«¯ç‚¹**
```
GET /oauth2/authorize?response_type=code&client_id=main-app-client&redirect_uri=http://localhost:8080/callback&scope=read,write&state=xyz
```

2. **ç”¨æˆ·ç™»å½•å¹¶æˆæƒ**ï¼ˆè‡ªåŠ¨è·³è½¬åˆ° SSO ç™»å½•é¡µé¢ï¼‰

3. **è·å–æˆæƒç **ï¼ˆé‡å®šå‘å›åº”ç”¨ï¼‰
```
http://localhost:8080/callback?code=æˆæƒç &state=xyz
```

4. **æ¢å–è®¿é—®ä»¤ç‰Œ**
```http
POST http://localhost:8081/oauth2/token
Content-Type: application/json

{
  "grant_type": "authorization_code",
  "code": "æˆæƒç ",
  "client_id": "main-app-client",
  "client_secret": "secret123",
  "redirect_uri": "http://localhost:8080/callback"
}
```

5. **ä½¿ç”¨è®¿é—®ä»¤ç‰Œè®¿é—®èµ„æº**
```http
GET http://localhost:8081/oauth2/userinfo
Authorization: Bearer {access_token}
```

### é€šç”¨æ¥å£

#### 1. è·å–å½“å‰ç”¨æˆ·ä¿¡æ¯
```http
GET http://localhost:8081/auth/info
Authorization: Bearer {token}
```

#### 2. ç”¨æˆ·ç™»å‡º
```http
POST http://localhost:8081/auth/logout
```

### OAuth2 å•ç‚¹ç™»å½•æ¥å£

#### 1. OAuth2 æˆæƒï¼ˆè·å–æˆæƒç ï¼‰
```http
GET http://localhost:8081/oauth2/authorize?response_type=code&client_id=main-app-client&redirect_uri=http://localhost:8080/callback&scope=read,write&state=xyz
```

#### 2. è·å–è®¿é—®ä»¤ç‰Œ
```http
POST http://localhost:8081/oauth2/token
Content-Type: application/json

{
  "grant_type": "authorization_code",
  "code": "æˆæƒç ",
  "client_id": "main-app-client",
  "client_secret": "secret123",
  "redirect_uri": "http://localhost:8080/callback"
}
```

#### 3. åˆ·æ–°è®¿é—®ä»¤ç‰Œ
```http
POST http://localhost:8081/oauth2/token
Content-Type: application/json

{
  "grant_type": "refresh_token",
  "refresh_token": "åˆ·æ–°ä»¤ç‰Œ",
  "client_id": "main-app-client",
  "client_secret": "secret123"
}
```

#### 4. è·å–ç”¨æˆ·ä¿¡æ¯ï¼ˆOAuth2èµ„æºç«¯ç‚¹ï¼‰
```http
GET http://localhost:8081/oauth2/userinfo
Authorization: Bearer {access_token}
```

### ç”¨æˆ·å¹³å°å…³è”æ¥å£

#### 1. ç»‘å®šå¹³å°è´¦å·
```http
POST http://localhost:8081/auth/platform/bind
Authorization: Bearer {token}
Content-Type: application/json

{
  "platformId": "2",
  "platformUserId": "user123",
  "platformUsername": "æµ‹è¯•ç”¨æˆ·"
}
```

#### 2. è§£ç»‘å¹³å°è´¦å·
```http
POST http://localhost:8081/auth/platform/unbind?platformId=2
Authorization: Bearer {token}
```

#### 3. è·å–å·²ç»‘å®šå¹³å°åˆ—è¡¨
```http
GET http://localhost:8081/auth/platform/bound
Authorization: Bearer {token}
```

### ç”¨æˆ·æ¥å£

#### 1. æ ¹æ®ç”¨æˆ·åè·å–ç”¨æˆ·
```http
GET http://localhost:8080/user/getByUsername/{username}
Authorization: Bearer {token}
```

#### 2. åˆ›å»ºç”¨æˆ·
```http
POST http://localhost:8080/user/create
Authorization: Bearer {token}
Content-Type: application/json

{
  "username": "test",
  "password": "123456",
  "nickname": "æµ‹è¯•ç”¨æˆ·"
}
```

### æµ‹è¯•è´¦å·

| ç”¨æˆ·å | å¯†ç  | è§’è‰² |
|--------|------|------|
| admin | 123456 | ç®¡ç†å‘˜ |
| user | 123456 | æ™®é€šç”¨æˆ· |

## ğŸ‘¥ ç”¨æˆ·ç®¡ç†

### å¦‚ä½•æ·»åŠ ç”¨æˆ·

ç³»ç»Ÿæä¾›ä¸‰ç§æ–¹å¼æ·»åŠ ç”¨æˆ·ï¼š

#### 1. ç”¨æˆ·è‡ªåŠ©æ³¨å†Œ
```bash
POST /user/register/self
{
  "username": "newuser",
  "password": "123456",
  "nickname": "æ–°ç”¨æˆ·",
  "phone": "13800138000",
  "email": "user@example.com",
  "captcha": "éªŒè¯ç ",
  "captchaKey": "éªŒè¯ç Key"
}
```

#### 2. ç®¡ç†å‘˜åˆ›å»ºç”¨æˆ·
```bash
POST /user/register/admin
Authorization: Bearer {ç®¡ç†å‘˜token}
{
  "username": "employee001",
  "password": "Welcome123",
  "nickname": "å‘˜å·¥001"
}
```

#### 3. å¹³å°ç”¨æˆ·è‡ªåŠ¨æ³¨å†Œ
å½“ç”¨æˆ·é¦–æ¬¡é€šè¿‡ OAuth2 SSO ä»å…¶ä»–å¹³å°ç™»å½•æ—¶ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨åˆ›å»ºç”¨æˆ·å¹¶ç»‘å®šå¹³å°å…³ç³»ã€‚

#### 4. æ•°æ®åº“ç›´æ¥æ’å…¥
```sql
INSERT INTO sys_user (user_id, username, password, nickname, status, deleted)
VALUES ('new_user_001', 'dbuser', 
        '$2a$10$N.zmdr9k7uOCQb376NoUnuTJ8iAt6Z5EHsM8lE9lBOsl7iKTVKIUi',
        'æ•°æ®åº“ç”¨æˆ·', 1, 0);
```

**è¯¦ç»†è¯´æ˜**ï¼šä»¥ä¸Šä¸ºå®Œæ•´çš„ç”¨æˆ·ç®¡ç†æ–¹å¼

## ğŸ“š æ–‡æ¡£

### API æ–‡æ¡£

å¯åŠ¨æœåŠ¡åï¼Œè®¿é—®ä»¥ä¸‹åœ°å€æŸ¥çœ‹APIæ–‡æ¡£ï¼š

- ç½‘å…³æœåŠ¡æ–‡æ¡£ï¼šhttp://localhost:8080/doc.html
- è®¤è¯æœåŠ¡æ–‡æ¡£ï¼šhttp://localhost:8081/doc.html
- ç”¨æˆ·æœåŠ¡æ–‡æ¡£ï¼šhttp://localhost:8082/doc.html

### æ ¸å¿ƒæ–‡æ¡£

**âš ï¸ ç³»ç»Ÿå·²é‡‡ç”¨çº¯ OAuth2 SSO ç™»å½•æ¨¡å¼**

1. **[SSO.md](SSO.md)** - SSO å•ç‚¹ç™»å½•æœåŠ¡å®Œæ•´æŒ‡å—ï¼ˆå¿…è¯»ï¼‰
   - OAuth2 åè®®å®ç°
   - æˆæƒç æ¨¡å¼æµç¨‹
   - å®¢æˆ·ç«¯æ¥å…¥æŒ‡å—
   - ç”¨æˆ·è´¦å·å…³è”
   - è·¨å¹³å°å•ç‚¹ç™»å½•
   - å®‰å…¨æœ€ä½³å®è·µ

2. **[SKYWALKING.md](SKYWALKING.md)** - SkyWalking åˆ†å¸ƒå¼è¿½è¸ªæœåŠ¡
   - åŠŸèƒ½ç‰¹æ€§å’Œä½¿ç”¨åœºæ™¯
   - å¿«é€Ÿå¼€å§‹æŒ‡å—
   - UI åŠŸèƒ½è¯´æ˜
   - æ€§èƒ½ç›‘æ§å’Œè¿½è¸ªåˆ†æ

3. **[SETUP.md](SETUP.md)** - ç¯å¢ƒé…ç½®æŒ‡å—
   - ç¯å¢ƒè¦æ±‚å’Œå®‰è£…
   - IDE é…ç½®
   - å¸¸è§é—®é¢˜è§£å†³

4. **[DEPLOY.md](DEPLOY.md)** - éƒ¨ç½²æŒ‡å—
   - æœ¬åœ°å¼€å‘éƒ¨ç½²
   - Docker éƒ¨ç½²
   - ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²
   - ç›‘æ§å’Œå¤‡ä»½ç­–ç•¥

## ğŸ”§ é…ç½®è¯´æ˜

### Nacosé…ç½®

æ‰€æœ‰æœåŠ¡éƒ½é›†æˆäº†Nacosé…ç½®ä¸­å¿ƒï¼Œæ”¯æŒé…ç½®åŠ¨æ€åˆ·æ–°ã€‚

**é…ç½®æ–‡ä»¶å‘½åè§„åˆ™**ï¼š
- `${spring.application.name}.yml` - æœåŠ¡ä¸“å±é…ç½®
- `common-config.yml` - å…¬å…±é…ç½®

### è®¤è¯é…ç½®

**Sa-Tokené…ç½®**

Sa-Tokenç”¨äºç»Ÿä¸€è®¤è¯é‰´æƒï¼š
- Tokenå­˜å‚¨ï¼šRedis
- Tokenæœ‰æ•ˆæœŸï¼š7å¤©
- æ”¯æŒå¹¶å‘ç™»å½•æ§åˆ¶

**OAuth2 å•ç‚¹ç™»å½•é…ç½®**

åŸºäº OAuth2 åè®®å®ç°çš„å•ç‚¹ç™»å½•ç³»ç»Ÿï¼š
- æˆæƒç æ¨¡å¼ï¼ˆAuthorization Codeï¼‰
- æ”¯æŒå¤šå¹³å°æ¥å…¥
- ç”¨æˆ·è´¦å·å…³è”
- è®¿é—®ä»¤ç‰Œå’Œåˆ·æ–°ä»¤ç‰Œåˆ†ç¦»
- æ”¯æŒè‡ªåŠ¨æˆæƒå’Œç”¨æˆ·ç¡®è®¤æˆæƒ

**æµ‹è¯•å®¢æˆ·ç«¯ä¿¡æ¯**ï¼š
- Client ID: `main-app-client`
- Client Secret: `secret123`
- Redirect URI: `http://localhost:8080/callback`

### Sentinelé™æµè§„åˆ™

Sentinelæä¾›æµé‡æ§åˆ¶å’Œç†”æ–­é™çº§åŠŸèƒ½ï¼š
- QPSé™æµ
- çº¿ç¨‹æ•°é™æµ  
- ç†”æ–­é™çº§
- ç³»ç»Ÿè‡ªé€‚åº”ä¿æŠ¤

## ğŸ“Š ç›‘æ§ä½“ç³»

### Prometheus + Grafana

1. **è®¿é—®Prometheus**: http://localhost:9090
2. **è®¿é—®Grafana**: http://localhost:3000 (admin/admin)
3. **é…ç½®æ•°æ®æº**ï¼šæ·»åŠ Prometheusæ•°æ®æº `http://prometheus:9090`
4. **å¯¼å…¥Dashboard**ï¼šæ¨èä½¿ç”¨JVM Micrometer Dashboard

### Sentinel Dashboard

1. **è®¿é—®æ§åˆ¶å°**: http://localhost:8858
2. **ç™»å½•è´¦å·**: sentinel/sentinel
3. **æŸ¥çœ‹å®æ—¶ç›‘æ§**ï¼šæµé‡ã€QPSã€å“åº”æ—¶é—´ç­‰
4. **é…ç½®é™æµè§„åˆ™**ï¼šæ”¯æŒåŠ¨æ€é…ç½®

### SkyWalking åˆ†å¸ƒå¼è¿½è¸ª

1. **è®¿é—®UI**: http://localhost:8088
2. **åŠŸèƒ½**ï¼š
   - ğŸ“Š æœåŠ¡æ‹“æ‰‘å›¾ï¼šå¯è§†åŒ–æœåŠ¡é—´è°ƒç”¨å…³ç³»
   - ğŸ” è¿½è¸ªæŸ¥è¯¢ï¼šæŸ¥çœ‹å®Œæ•´çš„è°ƒç”¨é“¾è·¯
   - ğŸ“ˆ æ€§èƒ½ç›‘æ§ï¼šæœåŠ¡ã€ç«¯ç‚¹ã€æ•°æ®åº“æ€§èƒ½
   - âš ï¸ å¼‚å¸¸è¿½è¸ªï¼šå¿«é€Ÿå®šä½é”™è¯¯
   - ğŸ“ æ—¥å¿—å…³è”ï¼šå…³è”æ—¥å¿—ä¸è¿½è¸ª

**è¯¦ç»†ä½¿ç”¨è¯´æ˜**: [SKYWALKING.md](SKYWALKING.md)

## ğŸ—‚ï¸ é¡¹ç›®ç»“æ„

```
my-framework/
â”œâ”€â”€ framework-common/              # å…¬å…±æ¨¡å—
â”‚   â”œâ”€â”€ src/main/java/
â”‚   â”‚   â””â”€â”€ com/myframework/common/
â”‚   â”‚       â”œâ”€â”€ config/           # é…ç½®ç±»
â”‚   â”‚       â”œâ”€â”€ constant/         # å¸¸é‡
â”‚   â”‚       â”œâ”€â”€ domain/           # å…¬å…±å®ä½“
â”‚   â”‚       â”œâ”€â”€ exception/        # å¼‚å¸¸å¤„ç†
â”‚   â”‚       â”œâ”€â”€ result/           # ç»Ÿä¸€å“åº”
â”‚   â”‚       â””â”€â”€ util/             # å·¥å…·ç±»
â”‚   â””â”€â”€ pom.xml
â”œâ”€â”€ framework-api/                 # APIæ¨¡å—
â”‚   â”œâ”€â”€ src/main/java/
â”‚   â”‚   â””â”€â”€ com/myframework/api/
â”‚   â”‚       â”œâ”€â”€ auth/             # è®¤è¯API
â”‚   â”‚       â””â”€â”€ user/             # ç”¨æˆ·API
â”‚   â””â”€â”€ pom.xml
â”œâ”€â”€ framework-gateway/             # ç½‘å…³æœåŠ¡
â”‚   â”œâ”€â”€ src/main/java/
â”‚   â”‚   â””â”€â”€ com/myframework/gateway/
â”‚   â”‚       â”œâ”€â”€ config/           # é…ç½®
â”‚   â”‚       â”œâ”€â”€ filter/           # è¿‡æ»¤å™¨
â”‚   â”‚       â””â”€â”€ handler/          # å¼‚å¸¸å¤„ç†
â”‚   â”œâ”€â”€ Dockerfile
â”‚   â””â”€â”€ pom.xml
â”œâ”€â”€ framework-auth/                # è®¤è¯æœåŠ¡
â”‚   â”œâ”€â”€ src/main/java/
â”‚   â”‚   â””â”€â”€ com/myframework/auth/
â”‚   â”‚       â”œâ”€â”€ controller/       # æ§åˆ¶å™¨
â”‚   â”‚       â”œâ”€â”€ service/          # æœåŠ¡å±‚
â”‚   â”‚       â”œâ”€â”€ entity/           # å®ä½“ç±»ï¼ˆOAuth2ã€å¹³å°ï¼‰
â”‚   â”‚       â”œâ”€â”€ mapper/           # Mapperæ¥å£
â”‚   â”‚       â””â”€â”€ dto/              # æ•°æ®ä¼ è¾“å¯¹è±¡
â”‚   â”œâ”€â”€ Dockerfile
â”‚   â””â”€â”€ pom.xml
â”œâ”€â”€ framework-user/                # ç”¨æˆ·æœåŠ¡
â”‚   â”œâ”€â”€ src/main/java/
â”‚   â”‚   â””â”€â”€ com/myframework/user/
â”‚   â”‚       â”œâ”€â”€ controller/       # æ§åˆ¶å™¨
â”‚   â”‚       â”œâ”€â”€ entity/           # å®ä½“ç±»
â”‚   â”‚       â”œâ”€â”€ mapper/           # Mapperæ¥å£
â”‚   â”‚       â””â”€â”€ service/          # æœåŠ¡å±‚
â”‚   â”œâ”€â”€ Dockerfile
â”‚   â””â”€â”€ pom.xml
â”œâ”€â”€ docker/                        # Dockeré…ç½®
â”‚   â”œâ”€â”€ mysql/                    # MySQLé…ç½®
â”‚   â”œâ”€â”€ redis/                    # Redisé…ç½®
â”‚   â””â”€â”€ prometheus/               # Prometheusé…ç½®
â”œâ”€â”€ docker-compose.yml             # Dockerç¼–æ’æ–‡ä»¶
â”œâ”€â”€ build.sh                       # æ„å»ºè„šæœ¬
â”œâ”€â”€ start.sh                       # å¯åŠ¨è„šæœ¬
â”œâ”€â”€ stop.sh                        # åœæ­¢è„šæœ¬
â”œâ”€â”€ pom.xml                        # çˆ¶POM
â””â”€â”€ README.md                      # é¡¹ç›®æ–‡æ¡£
```

## ğŸ” å®‰å…¨è¯´æ˜

### è®¤è¯æµç¨‹

**ç³»ç»Ÿé‡‡ç”¨çº¯ OAuth2 å•ç‚¹ç™»å½•æµç¨‹**ï¼š

1. ç”¨æˆ·è®¿é—®ç¬¬ä¸‰æ–¹åº”ç”¨
2. åº”ç”¨å¼•å¯¼ç”¨æˆ·åˆ° SSO æˆæƒç«¯ç‚¹
3. ç”¨æˆ·åœ¨ SSO ä¸­å¿ƒç™»å½•ï¼ˆå¦‚å·²ç™»å½•åˆ™è·³è¿‡ï¼‰
4. ç”¨æˆ·ç¡®è®¤æˆæƒï¼ˆå¯é…ç½®è‡ªåŠ¨æˆæƒï¼‰
5. SSO ç”Ÿæˆæˆæƒç å¹¶é‡å®šå‘å›åº”ç”¨
6. åº”ç”¨ä½¿ç”¨æˆæƒç æ¢å–è®¿é—®ä»¤ç‰Œ
7. åº”ç”¨ä½¿ç”¨è®¿é—®ä»¤ç‰Œè·å–ç”¨æˆ·ä¿¡æ¯
8. ç”¨æˆ·ç™»å½•æˆåŠŸï¼Œå¯è®¿é—®åº”ç”¨èµ„æº

### Tokenè¯´æ˜

**OAuth2 Token**ï¼ˆä¸»è¦ï¼‰ï¼š
- **Access Token**: è®¿é—®ä»¤ç‰Œï¼Œæœ‰æ•ˆæœŸé»˜è®¤1å°æ—¶ï¼ˆå¯é…ç½®ï¼‰
- **Refresh Token**: åˆ·æ–°ä»¤ç‰Œï¼Œæœ‰æ•ˆæœŸé»˜è®¤7å¤©ï¼ˆå¯é…ç½®ï¼‰
- æ”¯æŒä»¤ç‰Œæ’¤é”€å’ŒéªŒè¯
- å­˜å‚¨åœ¨æ•°æ®åº“ä¸­ï¼Œæ”¯æŒå¤šå¹³å°ç®¡ç†

### å¤šå¹³å°ç”¨æˆ·å…³è”

ç³»ç»Ÿæ”¯æŒç”¨æˆ·åœ¨å¤šä¸ªå¹³å°é—´å…³è”è´¦å·ï¼š
- **è´¦å·ç»‘å®š**: ç”¨æˆ·å¯ä»¥å°†å¤šä¸ªå¹³å°è´¦å·ç»‘å®šåˆ°ç»Ÿä¸€çš„ SSO è´¦å·
- **è´¦å·éš”ç¦»**: ä¸åŒå¹³å°çš„ç”¨æˆ·æ•°æ®ç›¸äº’éš”ç¦»
- **ç»Ÿä¸€ç™»å½•**: ä¸€æ¬¡ç™»å½•ï¼Œå¤šä¸ªå¹³å°å…ç™»å½•è®¿é—®
- **çµæ´»ç®¡ç†**: æ”¯æŒè´¦å·ç»‘å®šå’Œè§£ç»‘æ“ä½œ

## ğŸš€ æ€§èƒ½ä¼˜åŒ–

### æ•°æ®åº“ä¼˜åŒ–
- ä½¿ç”¨Druidè¿æ¥æ± 
- é…ç½®æ…¢SQLç›‘æ§
- å¯ç”¨MyBatis PlusæŸ¥è¯¢ç¼“å­˜

### ç¼“å­˜ä¼˜åŒ–
- Redisç¼“å­˜ç”¨æˆ·ä¼šè¯
- ä½¿ç”¨Redissonåˆ†å¸ƒå¼é”
- é…ç½®åˆç†çš„ç¼“å­˜è¿‡æœŸæ—¶é—´

### æ¥å£ä¼˜åŒ–
- Sentinelæµé‡æ§åˆ¶
- Gatewayå“åº”å¼ç¼–ç¨‹
- å¼‚æ­¥å¤„ç†è€—æ—¶æ“ä½œ

## ğŸ“– å¼€å‘æŒ‡å—

### æ·»åŠ æ–°çš„å¾®æœåŠ¡

1. åˆ›å»ºæ–°æ¨¡å—ï¼ˆå‚è€ƒframework-userï¼‰
2. æ·»åŠ åˆ°çˆ¶POMçš„modulesä¸­
3. é…ç½®NacosæœåŠ¡å‘ç°
4. åœ¨framework-apiä¸­å®šä¹‰Feignæ¥å£
5. åœ¨Gatewayä¸­é…ç½®è·¯ç”±è§„åˆ™
6. åˆ›å»ºDockerfile
7. æ·»åŠ åˆ°docker-compose.yml

### è‡ªå®šä¹‰é…ç½®

1. åœ¨Nacosä¸­åˆ›å»ºé…ç½®æ–‡ä»¶
2. åœ¨æœåŠ¡çš„bootstrap.ymlä¸­å¼•ç”¨
3. ä½¿ç”¨`@RefreshScope`æ”¯æŒåŠ¨æ€åˆ·æ–°

### APIæ–‡æ¡£ç¼–å†™

ä½¿ç”¨Knife4jæ³¨è§£ï¼š
```java
@Tag(name = "ç”¨æˆ·ç®¡ç†", description = "ç”¨æˆ·å¢åˆ æ”¹æŸ¥")
@Operation(summary = "è·å–ç”¨æˆ·ä¿¡æ¯")
```

## â“ å¸¸è§é—®é¢˜

### 1. Nacoså¯åŠ¨å¤±è´¥
- æ£€æŸ¥MySQLæ˜¯å¦æ­£å¸¸å¯åŠ¨
- ç¡®è®¤ç«¯å£8848æœªè¢«å ç”¨
- æŸ¥çœ‹æ—¥å¿—ï¼š`docker-compose logs nacos`

### 2. æœåŠ¡æ³¨å†Œå¤±è´¥
- ç¡®è®¤Nacoså·²å¯åŠ¨å®Œæˆ
- æ£€æŸ¥æœåŠ¡é…ç½®ä¸­çš„Nacosåœ°å€
- æŸ¥çœ‹æœåŠ¡æ—¥å¿—

### 3. TokenéªŒè¯å¤±è´¥
- æ£€æŸ¥Redisæ˜¯å¦æ­£å¸¸è¿è¡Œ
- ç¡®è®¤Tokenæ ¼å¼æ­£ç¡®ï¼ˆBearer {token}ï¼‰
- æŸ¥çœ‹Tokenæ˜¯å¦è¿‡æœŸ

### 4. æ•°æ®åº“è¿æ¥å¤±è´¥
- æ£€æŸ¥MySQLå®¹å™¨çŠ¶æ€
- ç¡®è®¤æ•°æ®åº“åˆå§‹åŒ–è„šæœ¬å·²æ‰§è¡Œ
- éªŒè¯æ•°æ®åº“ç”¨æˆ·åå¯†ç 

## ğŸ“ æ›´æ–°æ—¥å¿—

### v1.3.0 (æœ€æ–°) - é›†æˆ SkyWalking åˆ†å¸ƒå¼è¿½è¸ª
- âœ… **æ–°åŠŸèƒ½**ï¼šé›†æˆ Apache SkyWalking 9.7.0
- âœ… åˆ†å¸ƒå¼è¿½è¸ªï¼šè‡ªåŠ¨è¿½è¸ªæœåŠ¡é—´è°ƒç”¨é“¾è·¯
- âœ… æ€§èƒ½ç›‘æ§ï¼šå®æ—¶ç›‘æ§æœåŠ¡æ€§èƒ½æŒ‡æ ‡
- âœ… æœåŠ¡æ‹“æ‰‘ï¼šè‡ªåŠ¨ç”ŸæˆæœåŠ¡ä¾èµ–å…³ç³»å›¾
- âœ… æ•°æ®åº“ç›‘æ§ï¼šè¿½è¸ª SQL æ‰§è¡Œæƒ…å†µ
- âœ… å¼‚å¸¸è¿½è¸ªï¼šå¿«é€Ÿå®šä½é”™è¯¯æºå¤´
- âœ… è¯¦ç»†æ–‡æ¡£ï¼š[SKYWALKING.md](SKYWALKING.md)

### v1.2.0 - çº¯ OAuth2 SSO æ¨¡å¼
- âœ… **é‡å¤§å˜æ›´**ï¼šç§»é™¤ä¼ ç»Ÿç”¨æˆ·åå¯†ç ç™»å½•ï¼Œæ”¹ä¸ºçº¯ OAuth2 SSO æ¨¡å¼
- âœ… ä¼˜åŒ–æ¶æ„ï¼šç”¨æˆ·ç›¸å…³æ•°æ®åº“æ“ä½œç§»è‡³ user æ¨¡å—
- âœ… é€šè¿‡ Dubbo RPC å®ç°æœåŠ¡é—´é€šä¿¡
- âœ… æ–°å¢ SSO_ONLY_LOGIN.md çº¯ OAuth2 ç™»å½•è¯´æ˜æ–‡æ¡£
- âœ… æ›´æ–°æ‰€æœ‰ç›¸å…³æ–‡æ¡£å’Œç¤ºä¾‹

### v1.1.0
- âœ… å®ç° OAuth2 å•ç‚¹ç™»å½•ï¼ˆSSOï¼‰åŠŸèƒ½
- âœ… æ”¯æŒå¤šå¹³å°æ¥å…¥å’Œç”¨æˆ·è´¦å·å…³è”
- âœ… å®Œå–„æˆæƒç æ¨¡å¼å’Œä»¤ç‰Œç®¡ç†
- âœ… æ·»åŠ å¹³å°ç®¡ç†å’Œç”¨æˆ·ç»‘å®šåŠŸèƒ½
- âœ… æ–°å¢ SSO è¯¦ç»†ä½¿ç”¨æ–‡æ¡£

### v1.0.0
- åŸºç¡€å¾®æœåŠ¡æ¡†æ¶
- Sa-Token + JWT è®¤è¯
- ç½‘å…³è·¯ç”±å’ŒæœåŠ¡æ²»ç†
- ç›‘æ§å’Œå®¹å™¨åŒ–éƒ¨ç½²

## ğŸ“ å¾…åŠäº‹é¡¹

- [x] ~~å®ç°é“¾è·¯è¿½è¸ªï¼ˆSkyWalkingï¼‰~~ âœ… å·²å®Œæˆ
- [ ] å®ç° OAuth2 å…¶ä»–æˆæƒæ¨¡å¼ï¼ˆå¯†ç æ¨¡å¼ã€å®¢æˆ·ç«¯æ¨¡å¼ï¼‰
- [ ] æ·»åŠ  SSO ç™»å½•é¡µé¢å‰ç«¯ç•Œé¢
- [ ] é›†æˆç¬¬ä¸‰æ–¹ç™»å½•ï¼ˆå¾®ä¿¡ã€æ”¯ä»˜å®ç­‰ï¼‰
- [ ] é›†æˆæ¶ˆæ¯é˜Ÿåˆ—ï¼ˆRocketMQ/Kafkaï¼‰
- [ ] æ·»åŠ åˆ†å¸ƒå¼äº‹åŠ¡ï¼ˆSeataï¼‰
- [ ] æ·»åŠ æ›´å¤šä¸šåŠ¡æ¨¡å—
- [ ] å®Œå–„å•å…ƒæµ‹è¯•
- [ ] æ·»åŠ CI/CDæµç¨‹
- [ ] SkyWalking è‡ªå®šä¹‰å‘Šè­¦è§„åˆ™

## ğŸ¤ è´¡çŒ®æŒ‡å—

æ¬¢è¿æäº¤Issueå’ŒPull Requestï¼

## ğŸ“„ è®¸å¯è¯

MIT License

## ğŸ‘¥ è”ç³»æ–¹å¼

å¦‚æœ‰é—®é¢˜æˆ–å»ºè®®ï¼Œè¯·æäº¤Issueã€‚

---

**â­ å¦‚æœè¿™ä¸ªé¡¹ç›®å¯¹ä½ æœ‰å¸®åŠ©ï¼Œè¯·ç»™ä¸ªStaræ”¯æŒä¸€ä¸‹ï¼**

